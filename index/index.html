<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XMusic</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="video-background-container" id="videoBackgroundContainer">
        <video id="backgroundVideo" loop></video>
    </div>

    <div class="app-container">
        <aside class="sidebar">
            <div class="logo" id="xmusicLogo">XMusic</div>
            <div class="logo" id="xcreatorLogo" style="display: none;">XCreator</div>
            <nav class="main-nav" id="xmusicNav">
                <a href="#" id="navHome" class="nav-link active"><span>Главная</span></a>
                <a href="#" id="navCategories" class="nav-link"><span>Категории</span></a>
                <a href="#" id="navFavorites" class="nav-link"><span>Избранное</span></a>
                <a href="#" id="navVideos" class="nav-link"><span>Видео</span></a>
                <a href="#" id="navHistory" class="nav-link"><span>История</span></a>
            </nav>
            <nav class="creator-nav" id="xcreatorNav" style="display: none;">
                <a href="#" id="navCreatorDashboard" class="nav-link active"><span>Панель управления</span></a>
                <a href="#" id="navCreatorUpload" class="nav-link"><span>Загрузить</span></a>
                <a href="#" id="navCreatorAnalytics" class="nav-link"><span>Аналитика</span></a>
                <a href="#" id="navModeration" class="nav-link"><span>Модерация</span></a>
                <a href="#" id="navAdmin" class="nav-link"><span>Админ-панель</span></a>
            </nav>
            <div class="sidebar-footer">
                <button id="toggleCreatorModeBtn" class="creator-btn">Включить Creator Studio</button>
                <button id="settingsBtn" class="settings-btn">Настройки</button>
                <button id="logoutBtn" class="logout-btn" style="display: none;">Выйти</button>
            </div>
        </aside>

        <main class="main-content">
            <div class="main-header" id="mainHeader">
                <h1 id="pageTitle">Главная</h1>
                <div class="search-bar-wrapper">
                    <input type="text" id="searchInput" placeholder="Поиск музыки, артистов...">
                </div>
                <div class="header-controls">
                    <button id="loginBtn" class="login-btn">Войти</button>
                </div>
            </div>

            <div id="homeView" class="view active-view">
                <div id="xrecomenView">
                    <div class="xrecomen-section">
                        <button id="xrecomenBtn">XRecomen</button>
                        <p class="xrecomen-subtitle">Рекомендуем вам музыку на основе ваших предпочтений</p>
                    </div>
                </div>

                <div class="section">
                    <h2 class="section-title">Вам понравится</h2>
                    <div id="youLikeContainer" class="grid-container"></div>
                </div>

                <div class="section">
                    <h2 class="section-title">Вы можете это слушать</h2>
                    <div id="youMayLikeContainer" class="grid-container"></div>
                </div>

                <div class="section">
                    <h2 class="section-title">Любимые подборки</h2>
                    <div id="favoriteCollectionsContainer" class="grid-container"></div>
                </div>

                <div class="section">
                    <h2 class="section-title">Свежие релизы</h2>
                    <div id="newReleasesContainer" class="grid-container"></div>
                </div>

                <div class="section">
                    <h2 class="section-title">Популярные категории</h2>
                    <div id="popularCategoriesGrid" class="grid-container"></div>
                </div>
            </div>

            <div id="categoriesView" class="view">
                <div class="main-header">
                    <button id="backToCategoriesBtn" class="go-back-btn" style="display: none;">Назад</button>
                    <h1 id="categoriesPageTitle">Категории</h1>
                    <button id="createCategoryBtn" class="submit-btn" style="display: none;">Создать</button>
                </div>
                <div id="allCategoriesGrid" class="grid-container"></div>
                <div id="specificCategoryView" style="display: none;">
                    <h2 id="specificCategoryTitle"></h2>
                    <div id="specificCategoryGrid" class="grid-container"></div>
                </div>
            </div>

            <div id="videosView" class="view">
                <h1 id="videosPageTitle">Видео</h1>
                <div id="videosGrid" class="grid-container"></div>
            </div>

            <div id="historyView" class="view">
                <h1 id="historyPageTitle">История</h1>
                <div id="historyGrid" class="grid-container"></div>
            </div>
            
            <div id="favoritesView" class="view">
                <h1 id="favoritesPageTitle">Избранное</h1>
                <div class="favorites-container">
                    <div id="favoriteTracksGrid" class="grid-container"></div>
                </div>
            </div>
            
            <div id="creatorStudioView" class="view">
                <div id="creatorDashboard" class="creator-container">
                    <div class="creator-panel">
                        <h3>Панель управления</h3>
                        <p>Здесь будет отображаться статистика и важные уведомления для создателя.</p>
                        <p>Всего загружено треков: <span id="totalTracksCount">0</span></p>
                        <p>Всего прослушиваний: <span id="totalPlaysCount">0</span></p>
                        <p>Среднее количество прослушиваний: <span id="avgPlaysCount">0</span></p>
                    </div>
                </div>

                <div id="creatorUpload" class="creator-container" style="display: none;">
                    <div class="creator-panel">
                        <h3>Загрузка нового трека</h3>
                        <form id="uploadForm">
                            <div class="form-group">
                                <label for="uploadTitle">Название трека</label>
                                <input type="text" id="uploadTitle" required>
                            </div>
                            <div class="form-group">
                                <label for="uploadArtist">Исполнитель</label>
                                <input type="text" id="uploadArtist" required>
                            </div>
                            <div class="form-group">
                                <label for="uploadAlbum">Альбом (необязательно)</label>
                                <input type="text" id="uploadAlbum">
                            </div>
                            <div class="form-group">
                                <label for="uploadCategory">Категория</label>
                                <select id="uploadCategory" required></select>
                            </div>
                            <div class="form-group">
                                <label for="uploadFile">Файл трека (MP3 или MP4)</label>
                                <input type="file" id="uploadFile" accept=".mp3,.mp4" required>
                            </div>
                            <button type="submit" class="submit-btn">Загрузить</button>
                        </form>
                    </div>
                </div>

                <div id="creatorAnalytics" class="creator-container" style="display: none;">
                    <div class="creator-panel">
                        <h3>Аналитика</h3>
                        <div class="analytics-container">
                            <div class="analytics-block">
                                <h3>Топ-5 ваших треков</h3>
                                <div class="chart-container"><canvas id="topTracksChart"></canvas></div>
                            </div>
                            <div class="analytics-block">
                                <h3>Прослушивания по дням</h3>
                                <div class="chart-container"><canvas id="playsByDayChart"></canvas></div>
                            </div>
                            <div class="analytics-block">
                                <h3>Топ-5 пользователей, которые слушают вас</h3>
                                <div class="analytics-table-container">
                                    <table id="topListenersTable" class="analytics-table">
                                        <thead><tr><th>Пользователь</th><th>Прослушивания</th></tr></thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="analytics-block full-width">
                                <h3>Все ваши треки</h3>
                                <div class="analytics-table-container">
                                    <table id="myTracksTable" class="analytics-table">
                                        <thead><tr><th>Название</th><th>Прослушивания</th><th>Дата загрузки</th></tr></thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="moderationPanel" class="creator-container" style="display: none;">
                    <div class="creator-panel">
                        <h3>Модерация треков</h3>
                        <div id="moderationList"></div>
                    </div>
                </div>

                <div id="adminPanel" class="creator-container" style="display: none;">
                    <div class="creator-panel">
                        <h3>Панель администратора</h3>
                        <h4>Заявки на категорию</h4>
                        <div id="applicationList"></div>
                        <hr>
                        <h4>Управление пользователями</h4>
                        <div id="userManagementList"></div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <div class="music-player" id="musicPlayer">
        <div class="player-header">
            <img src="placeholder-cover.jpg" alt="Обложка" id="playerCover">
            <div class="track-info">
                <div class="title" id="playerTitle">Нет трека</div>
                <div class="artist" id="playerArtist">Исполнитель</div>
            </div>
        </div>
        <div class="control-buttons-and-progress">
            <div class="control-buttons">
                <button class="control-btn" id="prevBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg></button>
                <button class="play-button" id="playPauseBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="playIcon"><path d="M8 5v14l11-7z"/></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="pauseIcon" style="display: none;"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg></button>
                <button class="control-btn" id="nextBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16 18h2V6h-2zm-8.5 6l8.5-6V6z"/></svg></button>
                <button class="control-btn" id="repeatBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/></svg></button>
                <button class="control-btn" id="expandBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 4v2h3.59L3 17.59 4.41 19 16 7.41V11h2V4z"/></svg></button>
            </div>
            <div class="progress-bar">
                <span id="currentTime">0:00</span>
                <div class="progress-bar-container" id="progressBarContainer">
                    <div class="progress-track"></div>
                    <div class="progress-filled" id="progressBar"></div>
                    <div class="progress-thumb"></div>
                </div>
                <span id="duration">0:00</span>
            </div>
        </div>
        <div class="volume-controls">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="volumeIcon"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.81 5 3.54 5 6.71s-2.11 5.9-5 6.71v2.06c4.01-.91 7-4.43 7-8.77s-2.99-7.86-7-8.77z"/></svg>
            <input type="range" id="volumeBar" min="0" max="1" step="0.01" value="1">
        </div>
    </div>

    <div id="uploadModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" id="closeUploadModalBtn">&times;</button>
            <h2>Загрузить трек</h2>
            <form id="uploadTrackForm">
                <div class="upload-type-selector">
                    <input type="radio" id="uploadTypeFile" name="uploadType" value="file" checked>
                    <label for="uploadTypeFile"><span>Файл</span></label>
                    <input type="radio" id="uploadTypeLink" name="uploadType" value="link">
                    <label for="uploadTypeLink"><span>Ссылка</span></label>
                </div>

                <div id="fileUploadSection">
                    <div class="form-group">
                        <label for="trackFile">Выберите файл</label>
                        <div class="drag-and-drop-area" id="dragAndDropArea">
                            <p>Перетащите файл сюда или нажмите, чтобы выбрать</p>
                        </div>
                        <input type="file" id="trackFile" name="trackFile" accept=".mp3,.mp4" style="display: none;">
                    </div>
                </div>
                
                <div id="linkUploadSection" style="display: none;">
                    <div class="form-group">
                        <label for="trackLink">URL-адрес трека</label>
                        <input type="url" id="trackLink" name="trackLink" placeholder="Например, https://example.com/track.mp3">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="trackTitle">Название трека</label>
                    <input type="text" id="trackTitle" name="trackTitle" required>
                </div>
                
                <div class="form-group">
                    <label for="trackArtist">Исполнитель</label>
                    <input type="text" id="trackArtist" name="trackArtist" required>
                </div>

                <div class="form-group">
                    <label for="trackCategory">Категория</label>
                    <select id="trackCategory" name="trackCategory" required></select>
                </div>

                <div class="form-group">
                    <label>Жанр</label>
                    <div class="genre-buttons">
                        <button type="button" id="determineGenreBtn">Определить жанр</button>
                        <button type="button" id="selectGenreBtn">Выбрать вручную</button>
                    </div>
                    <div id="extendedPanel" style="display: none;">
                        <p><strong>Статус:</strong> <span id="panelStatusText">Ожидание...</span></p>
                        <p><strong>Жанр:</strong> <span id="panelGenreText">Неизвестно</span></p>
                        <div class="form-group inline-group" id="genreManualSelect" style="display: none;">
                            <label for="trackGenreManual">Выбрать жанр:</label>
                            <select id="trackGenreManual"></select>
                        </div>
                    </div>
                </div>

                <button type="submit" class="submit-btn" id="submitUploadBtn">Загрузить</button>
            </form>
        </div>
    </div>

    <div id="videoModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" id="closeVideoModalBtn">&times;</button>
            <video id="videoPlayerModal" controls></video>
        </div>
    </div>

    <div id="moderationModal" class="modal">
        <div class="moderation-content">
            <button class="close-btn" id="closeModerationModalBtn">&times;</button>
            <h2>Просмотр трека</h2>
            <div class="moderation-info">
                <img id="moderationCover" src="placeholder-cover.jpg" alt="Обложка" style="width: 150px; height: 150px; border-radius: 8px;">
                <h3 id="moderationTitle">Название трека</h3>
                <p id="moderationArtist">Исполнитель</p>
                <p>Категория: <span id="moderationCategory"></span></p>
            </div>
            <audio id="moderationPlayer" controls style="width: 100%;"></audio>
            <video id="moderationVideoPlayer" controls style="display: none; width: 100%;"></video>
            <div class="moderation-player-controls">
                <button class="approve-btn" id="approveBtn">Одобрить</button>
                <button class="reject-btn" id="rejectBtn">Отклонить</button>
            </div>
        </div>
    </div>

    <div id="authModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" id="closeAuthModalBtn">&times;</button>
            <h2 id="authTitle">Войти</h2>
            <form id="authForm">
                <div class="form-group">
                    <label for="authUsername">Имя пользователя</label>
                    <input type="text" id="authUsername" name="username" required>
                </div>
                <div class="form-group">
                    <label for="authPassword">Пароль</label>
                    <input type="password" id="authPassword" name="password" required>
                </div>
                <button type="submit" class="submit-btn" id="authSubmitBtn">Войти</button>
            </form>
            <button class="link-btn" id="toggleAuthMode">Нет аккаунта? Зарегистрироваться</button>
        </div>
    </div>

    <div id="applyModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" id="closeApplyModalBtn">&times;</button>
            <h2>Заявка в Creator Studio</h2>
            <form id="applyForm">
                <div class="form-group">
                    <label for="username">Имя пользователя</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="email">Почта</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <button type="submit" class="submit-btn">Подать заявку</button>
            </form>
        </div>
    </div>

    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" id="closeCategoryModalBtn" title="Закрыть">&times;</button>
            <h2>Создать категорию</h2>
            <form id="categoryForm">
                <input type="hidden" id="categoryId" name="categoryId">
                <div class="form-group">
                    <label for="categoryName">Название категории</label>
                    <input type="text" id="categoryName" required>
                </div>
                <div class="form-group user-input-wrapper">
                    <label for="userSearchInput">Пользователи, которые могут публиковать</label>
                    <div class="user-input-container">
                        <input type="text" id="userSearchInput" placeholder="Введите имя пользователя..." autocomplete="off">
                        <span id="userSearchStatus"></span>
                    </div>
                </div>
                <div id="selectedUsersContainer"></div>
                <button type="submit" class="submit-btn">Сохранить</button>
            </form>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>