<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XMusic</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="video-background-container" id="videoBackgroundContainer">
        <video id="backgroundVideo" loop></video>
    </div>

    <div class="app-container">
        <aside class="sidebar">
            <div class="logo" id="xmusicLogo">XMusic</div>
            <div class="logo" id="xcreatorLogo" style="display: none;">XCreator</div>
            
            <nav class="main-nav" id="xmusicNav">
                <a href="#" id="navHome" class="nav-link active"><span>Главная</span></a>
                <a href="#" id="navCategories" class="nav-link"><span>Категории</span></a>
                <a href="#" id="navFavorites" class="nav-link" style="display: none;"><span>Избранное</span></a>
                <a class="nav-link" id="creatorStudioBtn" style="display: none;"><span>Creator Studio</span></a>
                <a class="nav-link" id="settingsBtn"><span>Настройки</span></a>
            </nav>

            <nav class="main-nav" id="xcreatorNav" style="display: none;">
                <a class="go-back-btn" id="backToXMusicBtn"><span>&#8592; Назад в XMusic</span></a>
                <a class="creator-nav-btn active" id="creatorHomeBtn" style="display: none;"><span>Главная</span></a>
                <a class="creator-nav-btn" id="myTracksBtn" style="display: none;"><span>Мои треки</span></a>
                <a class="creator-nav-btn" id="analyticsBtn" style="display: none;"><span>Аналитика</span></a>
                <a class="creator-nav-btn admin-section" id="adminApplicationsBtn" style="display: none;"><span>Заявки в Creator</span></a>
                <a class="creator-nav-btn admin-section" id="adminUsersBtn" style="display: none;"><span>Аккаунты</span></a>
                <a class="creator-nav-btn admin-section" id="adminModerationBtn" style="display: none;"><span>Треки на модерации</span></a>
                <a class="creator-nav-btn admin-section" id="adminStatsBtn" style="display: none;"><span>Статистика</span></a>
                <a class="creator-nav-btn admin-section" id="adminCategoriesBtn" style="display: none;"><span>Категории</span></a>
                <a class="creator-nav-btn admin-section" id="adminLogsBtn" style="display: none;"><span>Логи</span></a>
            </nav>

            <div class="sidebar-footer">
                <div class="user-profile" id="userProfile" style="display: none;">
                    <div class="user-info-container">
                        <div class="user-avatar" id="userAvatar"></div>
                        <div class="user-text">
                            <span id="welcomeMessage" class="welcome-message"></span>
                            <span id="userRole" class="user-role"></span>
                        </div>
                    </div>
                    <button class="logout-btn" id="logoutBtn" style="display: none;"><span>Выйти</span></button>
                </div>
                <button class="login-btn" id="loginBtn"><span>Войти</span></button>
            </div>
        </aside>
        <main class="main-content">
            <header class="main-header">
                <h1 id="viewTitle">Главная</h1>
                <div class="header-controls">
                    <div class="search-bar-wrapper">
                        <input type="text" id="searchInput" placeholder="Поиск трека или исполнителя...">
                    </div>
                </div>
            </header>

            <div id="homeView" class="view active-view">
                <section class="section xrecomen-section" id="xrecomenSection">
                    <p id="nowPlayingText" class="now-playing-text"></p>
                    <button id="xrecomenBtn">
                        <span class="xrecomen-title">Xrecomen</span>
                        <span class="xrecomen-subtitle">Возможно, вам понравится</span>
                    </button>
                    <div class="equalizer" id="equalizer">
                        <div class="equalizer-bar"></div><div class="equalizer-bar"></div><div class="equalizer-bar"></div><div class="equalizer-bar"></div><div class="equalizer-bar"></div><div class="equalizer-bar"></div><div class="equalizer-bar"></div><div class="equalizer-bar"></div><div class="equalizer-bar"></div><div class="equalizer-bar"></div><div class="equalizer-bar"></div><div class="equalizer-bar"></div><div class="equalizer-bar"></div><div class="equalizer-bar"></div><div class="equalizer-bar"></div><div class="equalizer-bar"></div><div class="equalizer-bar"></div><div class="equalizer-bar"></div><div class="equalizer-bar"></div><div class="equalizer-bar"></div>
                    </div>
                </section>
                <section class="section" id="youLikeSection">
                    <h2 class="section-title">Вам нравятся</h2>
                    <div class="scroll-container" id="youLikeGrid"></div>
                </section>
                <section class="section">
                    <h2 class="section-title">Лучшее</h2>
                    <div class="scroll-container" id="allGridContainer"></div>
                </section>
                <section class="section" id="favoriteCollectionsSection">
                    <h2 class="section-title">Ваши любимые подборки</h2>
                    <div class="scroll-container" id="favoriteCollectionsGrid"></div>
                </section>
            </div>
            
            <div id="searchView" class="view">
                <h2 class="section-title" id="searchResultsTitle">Результаты поиска</h2>
                <div class="grid-container" id="searchResultsGrid"></div>
            </div>

            <div id="categoriesView" class="view">
                <section class="section">
                    <h2 class="section-title">Категории</h2>
                    <div class="grid-container" id="allCategoriesGrid"></div>
                </section>
            </div>
            
            <div id="specificCategoryView" class="view">
                <button class="go-back-btn back-to-categories-btn" id="backToCategoriesBtn"><span>&#8592; К категориям</span></button>
                <h2 class="section-title" id="specificCategoryTitle">Название категории</h2>
                <div class="grid-container" id="specificCategoryGrid"></div>
            </div>

            <div id="favoritesView" class="view">
                <div class="grid-container" id="favoritesGridContainer"></div>
            </div>

            <div id="creatorView" class="view">
                <div id="creatorHomeSection" class="creator-main-section">
                    <div class="creator-main-screen">
                        <h2>Добро пожаловать в XCreator Studio</h2>
                        <p>Здесь вы можете опубликовать свои творения и наблюдать за ними.</p>
                        <p>Чтобы публиковать треки, подайте заявку.</p>
                        <button class="apply-btn" id="applyBtn">Подать заявку</button>
                    </div>
                </div>
                <div id="myTracksSection" class="creator-main-section" style="display: none;"></div>
                <div id="analyticsSection" class="creator-main-section" style="display: none;">
                    <h2>Ваша статистика</h2>
                    <div class="analytics-container">
                        <div class="analytics-block">
                            <h3>Общее количество прослушиваний</h3>
                            <p class="stat-value" id="totalPlays">0</p>
                        </div>
                        <div class="analytics-block">
                            <h3>Прослушивания за последние 7 дней</h3>
                            <div class="chart-container">
                                <canvas id="analyticsChart"></canvas>
                            </div>
                        </div>
                        <div class="analytics-block">
                            <h3>Топ-5 популярных треков</h3>
                            <table class="analytics-table">
                                <thead>
                                    <tr>
                                        <th>Трек</th>
                                        <th>Прослушивания</th>
                                    </tr>
                                </thead>
                                <tbody id="analyticsTrackTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div id="adminApplicationsSection" class="creator-main-section" style="display: none;">
                    <h2 class="section-title">Заявки в Creator</h2>
                    <div id="applicationsList"></div>
                </div>
                <div id="adminUsersSection" class="creator-main-section" style="display: none;">
                    <h2 class="section-title">Аккаунты</h2>
                    <div id="usersList"></div>
                </div>
                <div id="adminModerationSection" class="creator-main-section" style="display: none;">
                    <h2 class="section-title">Треки на модерации</h2>
                    <div id="moderationTracksList" class="grid-container"></div>
                </div>
                <div id="adminStatsSection" class="creator-main-section" style="display: none;">
                    <div class="stats-grid" id="statsContent">
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <span class="stat-card-title">Всего пользователей</span>
                                <span class="stat-card-icon">👤</span>
                            </div>
                            <p class="stat-card-value" id="adminTotalUsers">0</p>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <span class="stat-card-title">Треков в медиатеке</span>
                                <span class="stat-card-icon">🎵</span>
                            </div>
                            <p class="stat-card-value" id="adminTotalTracks">0</p>
                        </div>
                    </div>
                </div>
                <div id="adminCategoriesSection" class="creator-main-section" style="display: none;">
                    <div class="admin-section-header">
                        <h2 class="section-title">Управление категориями</h2>
                        <button class="submit-btn create-category-btn" id="createCategoryBtn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/></svg>
                            <span>Создать категорию</span>
                        </button>
                    </div>
                    <div class="categories-management-list" id="adminCategoriesList"></div>
                </div>
                <div id="adminLogsSection" class="creator-main-section" style="display: none;">
                    <h2 class="section-title">Логи смены паролей</h2>
                    <div class="logs-container">
                        <table class="analytics-table">
                            <thead>
                                <tr>
                                    <th>Когда</th>
                                    <th>Кто (Админ)</th>
                                    <th>Кому (Цель)</th>
                                    <th>IP Адрес</th>
                                </tr>
                            </thead>
                            <tbody id="passwordLogsTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
        </div>

    <div class="player">
        
        <div class="player-style-default">
            <div class="player-header">
                <div class="track-info">
                    <img src="/fon/default.png" alt="Track Art" id="playerCover">
                    <div>
                        <span class="title" id="playerTitle">Выберите медиа</span>
                        <span class="artist" id="playerArtist"></span>
                    </div>
                </div>
            </div>
            
            <div class="control-buttons-and-progress">
                <div class="control-buttons">
                    <button id="repeatBtn" class="control-btn repeat-btn" title="Повтор"><svg fill="currentColor" viewBox="0 0 24 24"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/></svg></button>
                    <button id="prevBtn" class="control-btn" title="Назад"><svg fill="currentColor" viewBox="0 0 24 24"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg></button>
                    <button class="play-button" id="playPauseBtn" title="Воспроизвести">
                        <svg id="playIcon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                        <svg id="pauseIcon" style="display: none;" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></svg>
                    </button>
                    <button id="nextBtn" class="control-btn" title="Вперед"><svg fill="currentColor" viewBox="0 0 24 24"><path d="M16 18h2V6h-2zM6 18l8.5-6L6 6z"/></svg></button>
                    <button id="favoritePlayerBtn" class="control-btn" title="Добавить в избранное">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-heart">
                            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                        </svg>
                    </button>
                </div>
                
                <div class="progress-bar">
                    <span id="currentTime">0:00</span>
                    <div class="progress-bar-container">
                        <div class="progress-track"></div>
                        <div class="progress-filled"></div>
                        <div class="progress-thumb"></div>
                    </div>
                    <span id="duration">0:00</span>
                </div>
                
                <div class="volume-controls">
                    <svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
                    <input type="range" id="volumeBar" min="0" max="1" step="0.01" value="1">
                </div>
            </div>
        </div>

        <div class="player-style-copy" style="display: none;">
            <div class="copy-player-body">
                <div class="copy-track-info">
                    <img src="/fon/default.png" alt="Track Art" id="copyPlayerCover">
                    <div class="copy-track-text">
                        <span class="title" id="copyPlayerTitle">Выберите медиа</span>
                        <span class="artist" id="copyPlayerArtist"></span>
                    </div>
                </div>
                <div class="copy-main-controls">
                    <button id="copyPrevBtn" class="control-btn" title="Назад"><svg fill="currentColor" viewBox="0 0 24 24"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg></button>
                    <button class="play-button" id="copyPlayPauseBtn" title="Воспроизвести">
                        <svg id="copyPlayIcon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                        <svg id="copyPauseIcon" style="display: none;" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></svg>
                    </button>
                    <button id="copyNextBtn" class="control-btn" title="Вперед"><svg fill="currentColor" viewBox="0 0 24 24"><path d="M16 18h2V6h-2zM6 18l8.5-6L6 6z"/></svg></button>
                </div>
                <div class="copy-secondary-controls">
                     <button id="copyFavoriteBtn" class="control-btn" title="Добавить в избранное"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg></button>
                    <div class="copy-volume-controls">
                        <svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
                        <input type="range" id="copyVolumeBar" min="0" max="1" step="0.01" value="1">
                    </div>
                </div>
            </div>
            <div class="copy-progress-bar-container">
                <div class="copy-progress-filled"></div>
            </div>
        </div>
    </div>
    <div id="uploadModal" class="modal">
        <div class="modal-content upload-modal-container">
            <button class="close-btn" title="Закрыть">&times;</button>
            <h2 class="upload-modal-title">Загрузить медиа</h2>
            <p class="upload-modal-subtitle">Ваш трек будет отправлен на модерацию.</p>
            
            <form id="uploadForm">
                <div class="upload-modal-body">
                    <div class="upload-area">
                        <div class="upload-box cover-upload-box" id="coverDropArea">
                            <div class="upload-box-content">
                                <img src="" alt="Предпросмотр обложки" class="cover-preview" id="coverPreview" style="display: none;">
                                <div class="upload-box-placeholder" id="coverPlaceholder">
                                    <svg class="upload-icon" xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" viewBox="0 0 16 16"><path d="M4.502 9.5a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0zm3.25 1.75a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5z"/><path d="M10.804 8.443a.5.5 0 0 0 .083.58l.519.519a.5.5 0 0 0 .58.083l3.204-2.204a.5.5 0 0 0 0-.816l-3.204-2.204a.5.5 0 0 0-.58.083l-.519.519a.5.5 0 0 0-.083.58l1.454 1.054-1.454 1.054zm-9.3-1.63a.5.5 0 0 0-.083.58l.519.519a.5.5 0 0 0 .58.083l3.204-2.204a.5.5 0 0 0 0-.816L1.98 4.414a.5.5 0 0 0-.58.083l-.519.519a.5.5 0 0 0-.083.58l1.454 1.054-1.454 1.054z"/></svg>
                                    <p><b>Перетащите файл обложки</b></p>
                                    <p class="small">или нажмите для выбора</p>
                                    <span>PNG, JPG. Рекомендуется 1:1</span>
                                </div>
                            </div>
                            <input type="file" id="coverFile" name="coverFile" accept="image/*" required hidden>
                        </div>
                        <div class="upload-box media-upload-box" id="mediaDropArea">
                            <div class="upload-box-content">
                                <div class="upload-box-placeholder" id="mediaPlaceholder">
                                    <svg class="upload-icon" xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" viewBox="0 0 16 16"><path d="M12 13c0 1.105-1.12 2-2.5 2S7 14.105 7 13s1.12-2 2.5-2 2.5.895 2.5 2z"/><path d="M12 3v10h-1V3h1z"/><path d="M11 2.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-4a.5.5 0 0 1-.5-.5v-1z"/><path d="M2.05 3.54a.5.5 0 0 0-.5.5v8a.5.5 0 0 0 .5.5h4.15a2.5 2.5 0 0 0 0-1H2.5V4h4.152c.07-.833.37-1.554.77-2.162l-3.67-1.53A.5.5 0 0 0 3.05.854L.5 2.114A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .5.5h11a.5.5 0 0 0 .5-.5V9.828a2.502 2.502 0 0 0-1-.8V13H1.5V3.54l.55.23z"/></svg>
                                    <p><b>Перетащите аудио или видео</b></p>
                                    <p class="small">или нажмите для выбора</p>
                                    <span id="mediaFileName">Файл не выбран</span>
                                </div>
                            </div>
                            <input type="file" id="audioFile" name="audioFile" accept="audio/*" hidden>
                            <input type="file" id="videoFile" name="videoFile" accept="video/*" hidden>
                        </div>
                    </div>
                    <div class="upload-form-fields">
                        <div class="upload-type-selector">
                            <label><input type="radio" name="uploadType" value="audio" checked><span>Аудио</span></label>
                            <label><input type="radio" name="uploadType" value="video"><span>Видео</span></label>
                        </div>
                        <div class="form-group"><label for="trackTitle">Название</label><input type="text" id="trackTitle" name="title" required></div>
                        <div class="form-group">
                            <label for="categorySelect">Категория</label>
                            <select id="categorySelect" name="categoryId"></select>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label"><input type="checkbox" id="isForeignArtist"><span>Сторонний исполнитель</span></label>
                            <div id="artistFields" style="display: none;">
                                <label for="foreignArtistName">Имя исполнителя</label>
                                <input type="text" id="foreignArtistName" name="artist">
                            </div>
                        </div>
                        <div id="uploadManager">
                            <p id="uploadStatusText">Ожидание...</p>
                            <div class="upload-status-bar">
                                <div class="upload-progress-fill" style="width: 0;"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <button type="submit" class="submit-btn" id="uploadSubmitBtn">Отправить на модерацию</button>
            </form>
        </div>
    </div>
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" title="Закрыть">&times;</button>
            <h2>Настройки</h2>
            <div class="form-group">
                <label for="blurToggle">Фоновое размытие</label>
                <label class="switch">
                    <input type="checkbox" id="blurToggle" checked>
                    <span class="slider round"></span>
                </label>
            </div>
            <div class="form-group">
                <label for="opacitySlider">Непрозрачность интерфейса</label>
                <div class="slider-wrapper">
                    <input type="range" id="opacitySlider" min="0.1" max="1" step="0.05">
                    <span id="opacityValue">50%</span>
                </div>
            </div>
            <div class="form-group">
                <label>Стиль плеера</label>
                <div class="player-style-selector">
                    <button class="style-btn active" data-style="default">Default</button>
                    <button class="style-btn" data-style="copy">Copy</button>
                </div>
            </div>
        </div>
    </div>
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" title="Закрыть">&times;</button>
            <h2>Вход</h2>
            <form id="loginForm">
                <div class="form-group"><label for="loginUsername">Логин</label><input type="text" id="loginUsername" required></div>
                <div class="form-group"><label for="loginPassword">Пароль</label><input type="password" id="loginPassword" required></div>
                <button type="submit" class="submit-btn">Войти</button>
                <button type="button" class="link-btn" id="switchToRegister">Перейти к регистрации</button>
            </form>
        </div>
    </div>
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" title="Закрыть">&times;</button>
            <h2>Регистрация</h2>
            <form id="registerForm">
                <div class="form-group"><label for="registerUsername">Логин</label><input type="text" id="registerUsername" required></div>
                <div class="form-group"><label for="registerPassword">Пароль</label><input type="password" id="registerPassword" required></div>
                <button type="submit" class="submit-btn">Зарегистрироваться</button>
                <button type="button" class="link-btn" id="switchToLogin">Перейти ко входу</button>
            </form>
        </div>
    </div>
    <div id="applicationModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" title="Закрыть">&times;</button>
            <h2>Подать заявку в Creator Studio</h2>
            <form id="applicationForm">
                <div class="form-group"><label for="fullName">Имя и Фамилия</label><input type="text" id="fullName" name="fullName" required></div>
                <div class="form-group"><label for="phoneNumber">Номер телефона</label><input type="tel" id="phoneNumber" name="phoneNumber" pattern="\+7[0-9]{10}" placeholder="+79998887766" required></div>
                <div class="form-group"><label for="email">Почта</label><input type="email" id="email" name="email" required></div>
                <button type="submit" class="submit-btn">Подать заявку</button>
            </form>
        </div>
    </div>
    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" id="closeCategoryModalBtn" title="Закрыть">&times;</button>
            <h2>Создать категорию</h2>
            <form id="categoryForm">
                <input type="hidden" id="categoryId" name="categoryId">
                <div class="form-group">
                    <label for="categoryName">Название категории</label>
                    <input type="text" id="categoryName" required>
                </div>
                <div class="form-group user-input-wrapper">
                    <label for="userSearchInput">Пользователи, которые могут публиковать</label>
                    <div class="user-input-container">
                        <input type="text" id="userSearchInput" placeholder="Введите имя пользователя..." autocomplete="off">
                        <span id="userSearchStatus"></span>
                    </div>
                </div>
                <div id="selectedUsersContainer"></div>
                <button type="submit" class="submit-btn">Сохранить</button>
            </form>
        </div>
    </div>
    <script src="script.js"></script>
</body>
</html>