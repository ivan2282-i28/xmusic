<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XMusic</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.google.com/recaptcha/api.js?render=6LfDl7QrAAAAALG2gcYm42BZzuCsY_I7edgnMFzJ"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="video-background-container" id="videoBackgroundContainer">
        <video id="backgroundVideo" loop></video>
    </div>

    <div class="app-container">
        <aside class="sidebar">
            <div class="logo" id="xmusicLogo">XMusic</div>
            <div class="logo" id="xcreatorLogo" style="display: none;">XCreator</div>
            <nav class="main-nav" id="xmusicNav">
                <a href="#" id="navHome" class="nav-link active"><span>Главная</span></a>
                <a href="#" id="navCategories" class="nav-link"><span>Категории</span></a>
                <a href="#" id="navFavorites" class="nav-link" style="display: none;"><span>Избранное</span></a>
                <a href="#" id="navCreator" class="nav-link" style="display: none;"><span>Creator Studio</span></a>
                <a href="#" id="navAdmin" class="nav-link" style="display: none;"><span>Админ</span></a>
                <div class="auth-links">
                    <a href="#" id="navLogin" class="nav-link"><span>Войти</span></a>
                    <a href="#" id="navLogout" class="nav-link" style="display: none;"><span>Выйти</span></a>
                </div>
            </nav>
            <nav class="admin-nav" id="adminNav" style="display: none;"></nav>
        </aside>

        <main class="main-content">
            <div class="search-bar-wrapper">
                <input type="text" id="searchInput" placeholder="Поиск по названию, исполнителю...">
                <button class="search-btn"><i class="fas fa-search"></i></button>
            </div>
            
            <div id="homeView" class="content-view active">
                <div class="greeting-section">
                    <h1 id="userGreeting"></h1>
                    <button id="toggleThemeBtn" class="theme-btn"><i class="fas fa-sun"></i></button>
                </div>
                
                <section class="section" id="xrecomenSection" style="display: none;">
                    <h2>Рекомендуем вам</h2>
                    <div id="xrecomenContainer" class="grid-container horizontal-grid"></div>
                </section>
                
                <section class="section" id="youLikeSection" style="display: none;">
                    <h2>Вам нравятся</h2>
                    <div id="youLikeContainer" class="grid-container horizontal-grid"></div>
                </section>
                
                <section class="section" id="youMayLikeSection" style="display: none;">
                    <h2>Вам могут понравиться</h2>
                    <div id="youMayLikeContainer" class="grid-container horizontal-grid"></div>
                </section>
                
                <section class="section" id="likedCollectionsSection" style="display: none;">
                    <h2>Любимые подборки</h2>
                    <div id="likedCollectionsContainer" class="grid-container horizontal-grid"></div>
                </section>

                <section class="section">
                    <h2>Новинки</h2>
                    <div id="allGridContainer" class="grid-container"></div>
                </section>
                
                <div id="searchResultsContainer" class="content-view"></div>
            </div>

            <div id="categoriesView" class="content-view">
                <section class="section">
                    <h2>Жанры</h2>
                    <div id="allGenresGrid" class="grid-container"></div>
                </section>
                <section class="section">
                    <h2>Категории</h2>
                    <ul id="categoriesList" class="categories-list"></ul>
                </section>
            </div>

            <div id="specificCategoryView" class="content-view">
                <section class="section">
                    <button id="backToCategoriesBtn" class="back-btn"><i class="fas fa-arrow-left"></i> Назад</button>
                    <h2 id="specificCategoryName"></h2>
                    <div id="categoryTracksGrid" class="grid-container"></div>
                </section>
            </div>

            <div id="favoritesView" class="content-view">
                <section class="section">
                    <h2>Избранное</h2>
                    <div id="favoritesGridContainer" class="grid-container"></div>
                </section>
            </div>
            
            <div id="creatorView" class="content-view">
                <div class="creator-header">
                    <h2>Creator Studio</h2>
                </div>
                <div class="creator-main">
                    <div class="creator-left">
                        <section class="creator-section">
                            <h3>Мои треки</h3>
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Название</th>
                                        <th>Обложка</th>
                                        <th>Действия</th>
                                    </tr>
                                </thead>
                                <tbody id="creatorTracksTableBody">
                                </tbody>
                            </table>
                        </section>
                        <section class="creator-section">
                            <h3>Загрузка нового трека</h3>
                            <form id="uploadMusicForm" class="upload-form">
                                <div class="form-group">
                                    <label for="uploadTitle">Название трека</label>
                                    <input type="text" id="uploadTitle" name="title" required>
                                </div>
                                <div class="form-group">
                                    <label for="uploadArtist">Имя исполнителя (необязательно)</label>
                                    <input type="text" id="uploadArtist" name="artist">
                                </div>
                                <div class="form-group">
                                    <label for="creatorGenreSelect">Жанр</label>
                                    <select id="creatorGenreSelect" name="genreId" required></select>
                                </div>
                                <div class="form-group">
                                    <label for="creatorCategorySelect">Категория</label>
                                    <select id="creatorCategorySelect" name="categoryId"></select>
                                </div>
                                <div class="form-group">
                                    <label for="uploadType">Тип медиа</label>
                                    <select id="uploadType" name="uploadType" required>
                                        <option value="audio">Аудио</option>
                                        <option value="video">Видео</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="audioFile">Файл аудио</label>
                                    <input type="file" id="audioFile" name="audioFile" accept="audio/*">
                                </div>
                                <div class="form-group">
                                    <label for="videoFile">Файл видео</label>
                                    <input type="file" id="videoFile" name="videoFile" accept="video/*">
                                </div>
                                <div class="form-group">
                                    <label for="coverFile">Обложка</label>
                                    <input type="file" id="coverFile" name="coverFile" accept="image/*" required>
                                </div>
                                <button type="submit" class="submit-btn">Отправить на модерацию</button>
                            </form>
                        </section>
                    </div>
                    <div class="creator-right">
                        <section class="creator-section">
                            <h3>Статистика</h3>
                            <div class="stats-card">
                                <span>Всего прослушиваний</span>
                                <span id="totalPlays">0</span>
                            </div>
                            <div class="stats-card">
                                <h4>Прослушивания за 2 недели</h4>
                                <canvas id="dailyPlaysChart"></canvas>
                            </div>
                            <h4>Топ 5 треков</h4>
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Название</th>
                                        <th>Прослушивания</th>
                                    </tr>
                                </thead>
                                <tbody id="trackStatsTableBody">
                                </tbody>
                            </table>
                        </section>
                    </div>
                </div>
            </div>
            
            <div id="adminView" class="content-view">
                <div class="admin-header">
                    <h2>Панель администратора</h2>
                </div>
                <div class="admin-grid">
                    <section class="admin-section">
                        <h3>Общая статистика</h3>
                        <div class="stats-container">
                            <div class="stat-card">
                                <span>Всего пользователей</span>
                                <span id="adminTotalUsers">0</span>
                            </div>
                            <div class="stat-card">
                                <span>Всего треков</span>
                                <span id="adminTotalTracks">0</span>
                            </div>
                        </div>
                    </section>
                    <section class="admin-section">
                        <h3>Модерация треков</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Название</th>
                                    <th>Автор</th>
                                    <th>Тип</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody id="moderationTableBody">
                            </tbody>
                        </table>
                    </section>
                    <section class="admin-section">
                        <h3>Заявки на креатора</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Пользователь</th>
                                    <th>ФИО</th>
                                    <th>Почта</th>
                                    <th>Телефон</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody id="applicationsTableBody">
                            </tbody>
                        </table>
                    </section>
                    <section class="admin-section">
                        <h3>Управление пользователями</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Имя</th>
                                    <th>Роль</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody id="adminUsersTableBody">
                            </tbody>
                        </table>
                    </section>
                    <section class="admin-section">
                        <h3>Управление категориями</h3>
                        <button class="submit-btn" id="createCategoryBtn">Создать категорию</button>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Название</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody id="adminCategoriesTableBody">
                            </tbody>
                        </table>
                    </section>
                </div>
            </div>
        </main>
    </div>
    
    <div class="main-player hidden">
        <div class="player-cover">
            <img id="playerCover" src="" alt="Cover">
        </div>
        <div class="player-details">
            <h3 id="playerTitle">Название трека</h3>
            <p id="playerArtist">Исполнитель</p>
        </div>
        <div class="player-controls">
            <button id="skipPrevBtn" class="control-btn"><i class="fas fa-backward"></i></button>
            <button id="playPauseBtn" class="control-btn"><i class="fas fa-play"></i></button>
            <button id="skipNextBtn" class="control-btn"><i class="fas fa-forward"></i></button>
        </div>
        <div class="player-timeline">
            <span id="timeCurrent">00:00</span>
            <div id="progressBarContainer" class="progress-bar-container">
                <div id="progressBar" class="progress-bar"></div>
            </div>
            <span id="timeDuration">00:00</span>
        </div>
        <div class="player-options">
            <button id="shuffleBtn" class="option-btn"><i class="fas fa-random"></i></button>
            <button id="repeatBtn" class="option-btn"><i class="fas fa-redo"></i></button>
            <input type="range" id="volumeBar" min="0" max="1" step="0.01" value="1">
            <button id="toggleFavoritesBtn" class="option-btn"><i class="fas fa-heart-o"></i></button>
        </div>
    </div>

    <div id="loginModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" title="Закрыть">&times;</button>
            <h2>Вход</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginUsername">Имя пользователя</label>
                    <input type="text" id="loginUsername" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Пароль</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <input type="hidden" name="recaptcha_token" id="loginRecaptchaToken">
                <div class="form-actions">
                    <button type="submit" class="submit-btn">Войти</button>
                    <button type="button" class="link-btn" id="showRegistrationBtn">Нет аккаунта? Зарегистрироваться</button>
                </div>
                <p id="loginMessage" class="message"></p>
            </form>
        </div>
    </div>

    <div id="registrationModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" title="Закрыть">&times;</button>
            <h2>Регистрация</h2>
            <form id="registrationForm">
                <div class="form-group">
                    <label for="registrationUsername">Имя пользователя</label>
                    <input type="text" id="registrationUsername" required>
                </div>
                <div class="form-group">
                    <label for="registrationPassword">Пароль</label>
                    <input type="password" id="registrationPassword" required>
                </div>
                <input type="hidden" name="recaptcha_token" id="registrationRecaptchaToken">
                <div class="form-actions">
                    <button type="submit" class="submit-btn">Зарегистрироваться</button>
                    <button type="button" class="link-btn" id="showLoginBtn">Уже есть аккаунт? Войти</button>
                </div>
                <p id="registrationMessage" class="message"></p>
            </form>
        </div>
    </div>

    <div id="trackDetailsModal" class="modal">
        <div class="modal-content track-details">
            <button class="close-btn" title="Закрыть">&times;</button>
            <img id="trackDetailsCover" src="" alt="Cover">
            <h3 id="trackDetailsTitle"></h3>
            <p id="trackDetailsArtist"></p>
            <div id="trackDetailsPlayer"></div>
        </div>
    </div>

    <div id="moderationModal" class="modal">
        <div class="modal-content moderation-content">
            <button class="close-btn" title="Закрыть">&times;</button>
            <h2>Просмотр трека</h2>
            <div class="player-container">
                <audio controls id="moderationPlayer" style="display: none;"></audio>
                <video controls id="moderationVideoPlayer" style="display: none;"></video>
            </div>
            <div class="moderation-actions">
                <button id="moderationApproveBtn" class="submit-btn">Одобрить</button>
                <button id="moderationRejectBtn" class="cancel-btn">Отклонить</button>
            </div>
        </div>
    </div>

    <div id="userModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" id="userModalClose" title="Закрыть">&times;</button>
            <h2 id="userModalTitle">Управление пользователем</h2>
            <form id="changeRoleForm">
                <div class="form-group">
                    <label for="userRoleSelect">Роль</label>
                    <select id="userRoleSelect" name="role">
                        <option value="user">user</option>
                        <option value="creator">creator</option>
                        <option value="admin">admin</option>
                    </select>
                </div>
                <button type="submit" class="submit-btn">Сменить роль</button>
            </form>
            <hr>
            <form id="changePasswordForm">
                <div class="form-group">
                    <label for="newPasswordInput">Новый пароль</label>
                    <input type="password" id="newPasswordInput" required>
                </div>
                <button type="submit" class="submit-btn">Сменить пароль</sbutton>
            </form>
            <hr>
            <button id="deleteUserBtn" class="cancel-btn">Удалить пользователя</button>
        </div>
    </div>

    <div id="applyForCreatorModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" title="Закрыть">&times;</button>
            <h2>Стать креатором</h2>
            <form id="applyForCreatorForm">
                <div class="form-group"><label for="fullName">Полное имя</label><input type="text" id="fullName" name="fullName" required></div>
                <div class="form-group"><label for="phoneNumber">Номер телефона</label><input type="tel" id="phoneNumber" name="phoneNumber" required></div>
                <div class="form-group"><label for="email">Почта</label><input type="email" id="email" name="email" required></div>
                <button type="submit" class="submit-btn">Подать заявку</button>
            </form>
        </div>
    </div>

    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" id="closeCategoryModalBtn" title="Закрыть">&times;</button>
            <h2>Создать категорию</h2>
            <form id="categoryForm">
                <input type="hidden" id="categoryId" name="categoryId">
                <div class="form-group">
                    <label for="categoryName">Название категории</label>
                    <input type="text" id="categoryName" required>
                </div>
                <div class="form-group user-input-wrapper">
                    <label for="userSearchInput">Пользователи, которые могут публиковать</label>
                    <div class="user-input-container">
                        <input type="text" id="userSearchInput" placeholder="Введите имя пользователя..." autocomplete="off">
                        <span id="userSearchStatus"></span>
                    </div>
                </div>
                <div id="selectedUsersContainer"></div>
                <button type="submit" class="submit-btn">Сохранить</button>
            </form>
        </div>
    </div>
    
    <div id="adminSection" class="admin-section" style="display: none;"></div>
    <div id="creatorSection" class="creator-section" style="display: none;"></div>

    <script src="script.js"></script>
</body>
</html>